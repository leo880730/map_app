<!DOCTYPE html>
<html lang="enzh-Hant-TW">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Map_app_scoring</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="./style.css">
  <!-- popper -->
  <!-- <script src="https://unpkg.com/@popperjs/core@2" crossorigin="anonymous"></script> -->
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.js" crossorigin="anonymous"></script>
  <!-- Bootstrap -->
  <script src="./../js/bootstrap.bundle.min.js"></script>
  <script src="./../js/bootstrap.min.js"></script>
  <script src="https://kit.fontawesome.com/dfe50b8167.js" crossorigin="anonymous"></script>
</head>

<body>
  <header>
    <nav>
      <button type="button" class="btn" id="previous-btn" onclick="location.href='./../index.html'">
        <i class="fa-solid fa-arrow-left"></i>
      </button>

      <div class="scoring-title">路段評分</div>

    </nav>
  </header>

  <main>
    <div class="map-search-bar">
      <div class="search-bar-icon-container">
        <i class="fa-solid fa-location-dot" id="search-bar-icon"></i>
      </div>
      <div class="road-input-container">
        <!-- <div class="search-description" id="road-search-description">路段</div> -->
        <input class="map-search-input" id="road-input" placeholder="輸入路段">
      </div>
      <!-- <div class="origin-number-container">
        <div class="search-description" id="origin-search-description">起點</div>
        <input type="text" class="map-search-input" id="origin-number-input">
      </div> -->
      <!-- <div id="map-search-input-span-container-1">
        <span class="map-search-input-span">號</span>
        <span class="map-search-input-span">-</span>
      </div> -->
      <!-- <div class="destination-number-container">
        <div class="search-description" id="destination-search-description">終點</div>
        <input type="text" class="map-search-input" id="destination-number-input">
      </div> -->
      <!-- <div id="map-search-input-span-container-2">
        <span class="map-search-input-span">號</span>
      </div> -->
    </div>

    <div class="map-container" id="map">
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script>

      function initMap() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function (position) {
            var pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            var map = new google.maps.Map(document.getElementById('map'), {
              zoom: 16,
              center: pos
            });
            var marker = new google.maps.Marker({
              position: pos,
              // icon:'marker.png',
              map: map
            });
            map.setZoom(16);
            map.setCenter(pos);

            const autocomplete = new google.maps.places.Autocomplete(
              document.getElementById('road-input'),
              // document.querySelector('#origin-number-input'),
              {
                types: ['route'],
                bounds: {
                  east: pos.lng + 0.1,
                  west: pos.lng - 0.1,
                  south: pos.lat - 0.1,
                  north: pos.lat + 0.1,
                },
                strictBounds: false,
              }
            );
            autocomplete.addListener('place_changed', function () {
              const place = autocomplete.getPlace();
              // console.log(place)
              map.setCenter(place.geometry.location)
              marker.setPosition(place.geometry.location)

              // let directionService = new google.maps.directionService();

              // let origin = document.querySelector('#origin-number-input').value
              // let destination = document.querySelector('#destination-number-input').value
              // let road = document.querySelector('#road-input').value
              // $.ajax({
              //   url: `https://maps.googleapis.com/maps/api/geocode/json?address=${road}+${origin}&key=AIzaSyBbNQvY6xQyNdxOrYl9aQFzN76u9AH30n8&callback=initMap`,
              //   success: function (data) {
              //     let originLat = data.results[0].geometry.location.lat
              //     let originLng = data.results[0].geometry.location.lng
              //     console.log(originLat)
              //   },
              //   error: function () {
              //     consol.log("error")
              //   }
              // }, {
              //   url: `https://maps.googleapis.com/maps/api/geocode/json?address=${road}+${destination}&key=AIzaSyBbNQvY6xQyNdxOrYl9aQFzN76u9AH30n8&callback=initMap`,
              //   success: function (data2) {
              //     let destinationLat = data2.results[0].geometry.location.lat
              //     let destinationLng = data2.results[0].geometry.location.lng
              //     console.log(destinationLat)
              //   },
              //   error: function () {
              //     consol.log("error")
              //   }
              // }
              // )
              // console.log(originLat)
              // console.log(destinationLat)
              // let directionRenderer = new google.maps.directionRenderer({
              //   map: map,
              // })
              // directionRenderer.set('direction', null);
              // directionService.route({
              //   origin:
              // }
              // )

            })
          });
        } else {
          // Browser doesn't support Geolocation
          alert("未允許或遭遇錯誤！");
        }
      }
    </script>
    <script async
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBbNQvY6xQyNdxOrYl9aQFzN76u9AH30n8&libraries=places&callback=initMap">
      </script>

  </main>

  <footer>
    <div class="footer-title-container">
      <h1 class="footer-title">請選擇您要評分的路段！</h1>
    </div>
    <div class="scoring-button-container">
      <button type="button" class="btn" id="scoring-button">
        <!-- onclick="location.href='.scoring.html'"  -->
        開始評分
      </button>
    </div>
  </footer>
</body>

<script>
  let roadInput = document.querySelector('#road-input')
  // let originNumberInput = document.querySelector('#origin-number-input')
  // let destinationNumberInput = document.querySelector('#destination-number-input')
  let scoringBtn = document.querySelector('#scoring-button')

  scoringBtn.addEventListener('click', function () {
    let roadInputValue = roadInput.value
    // let originNumberInputValue = originNumberInput.value
    // let destinationNumberInputValue = destinationNumberInput.value
    if (roadInputValue.length == 0) {
      alert('請輸入路段地址！')
    } else {
      window.localStorage.setItem('road', roadInputValue)
      // window.localStorage.setItem('origin', originNumberInputValue)
      // window.localStorage.setItem('destination', destinationNumberInputValue)
      location.href = './scoring.html'
    }
  })
</script>

</html>